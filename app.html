<!DOCTYPE html>
<html>

<head>
    <base target="_top">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="UTF-8">
    <title>배움로그</title>
    <link rel="icon" type="image/png" href="images/Gemini_Generated_Image_d19ctrd19ctrd19c.png">
    <link rel="apple-touch-icon" href="images/Gemini_Generated_Image_d19ctrd19ctrd19c.png">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
    <link rel="stylesheet" href="style.css?v=20260217-1">
    <link rel="stylesheet" href="style_theme.css?v=20260217-1">
    <link href="https://fonts.googleapis.com/css2?family=Jua&family=Noto+Sans+KR:wght@400;500;700&display=swap"
        rel="stylesheet">
</head>

<body>
    <div class="card">
        <!-- 로딩 화면 -->
        <div id="authLoadingSection" class="auth-loading-wrap">
            <div class="spinner auth-loading-spinner">
            </div>
            <p class="auth-loading-text">로그인 확인 중...</p>
        </div>

        <!-- 학생 온보딩 (첫 사용자) -->
        <div id="studentOnboardingSection" class="hidden">
            <h1 class="app-title">
                <img class="floating-emoji app-brand-icon" src="images/Gemini_Generated_Image_d19ctrd19ctrd19c-removebg-preview.png" alt="배움로그 아이콘">
                <span class="app-title-text">배움로그</span>
            </h1>
            <div class="top-action-row-end">
                <button onclick="logoutGoogle()"
                    class="btn-logout-compact">로그아웃</button>
            </div>
            <div class="accent-box box-blue">
                <span class="box-label">👩‍🎓 학급 설정 (처음 1회만)</span>
                <p class="onboard-desc">
                    선생님이 알려준 학급 정보를 입력해주세요.<br>한 번만 입력하면 다음부터 자동 로그인됩니다!
                </p>
                <label>학급명</label>
                <input type="text" id="onboardClassName" placeholder="예: 부평서초6-1" required>
                <label>클래스 코드</label>
                <input type="text" id="onboardClassCode" placeholder="선생님이 알려준 코드 (예: 부평서초34)" maxlength="20" required>
                <div class="type-selector">
                    <label><input type="radio" name="onboardType" value="individual" checked> 👤 개인</label>
                    <label><input type="radio" name="onboardType" value="group"> 👥 모둠</label>
                </div>
                <label id="onboardIdLabel">나의 번호</label>
                <input type="number" id="onboardStudentNumber" placeholder="번호 입력 (예: 15)" required>
                <button type="button" id="saveOnboardBtn" onclick="saveStudentOnboarding()"
                    class="btn-onboard-student">설정 완료</button>
                <div id="onboardMsg" class="message"></div>
            </div>
        </div>

        <!-- 교사 온보딩 (첫 사용자) -->
        <div id="teacherOnboardingSection" class="hidden">
            <h1 class="app-title">
                <img class="floating-emoji app-brand-icon" src="images/Gemini_Generated_Image_d19ctrd19ctrd19c-removebg-preview.png" alt="배움로그 아이콘">
                <span class="app-title-text">배움로그</span>
            </h1>
            <div class="top-action-row-end">
                <button onclick="logoutGoogle()"
                    class="btn-logout-compact">로그아웃</button>
            </div>
            <div class="accent-box box-violet">
                <span class="box-label">👨‍🏫 클래스 만들기 (처음 1회만)</span>
                <p class="onboard-desc">
                    ✨ 새 클래스를 만들어보세요!<br>한 번만 설정하면 다음부터 자동으로 접속됩니다.
                </p>
                <label>학급명 설정</label>
                <input type="text" id="newOnboardClassName" placeholder="예: 부평서초6-1" required>
                <label>클래스 코드 설정</label>
                <input type="text" id="newOnboardClassCode" placeholder="예: 부평서초34, math1" maxlength="20" required>
                <p class="onboard-hint">
                    1~10자리, 숫자·영문·한글 조합 가능</p>
                <button type="button" id="saveTeacherOnboardBtn" onclick="saveTeacherOnboarding()"
                    class="btn-onboard-teacher">클래스 생성하기</button>
                <div id="teacherOnboardMsg" class="message"></div>
            </div>
        </div>

        <!-- 학생 메인 (기존 사용자 / 온보딩 후) -->
        <div id="studentTab" class="hidden">
            <h1 class="app-title">
                <img class="floating-emoji app-brand-icon" src="images/Gemini_Generated_Image_d19ctrd19ctrd19c-removebg-preview.png" alt="배움로그 아이콘">
                <span class="app-title-text">배움로그</span>
            </h1>
            <div id="studentMainSection" class="hidden">
                <div class="student-header-row">
                    <span id="welcomeMsg" class="welcome-msg"></span>
                    <button onclick="logoutGoogle()"
                        class="btn-logout-main">로그아웃</button>
                </div>
                <!-- 기존 탭 내비게이션 (롤백용 주석 처리) -->
                <!-- <div class="mini-tab-container">
                    <button class="mini-tab-btn active-student" onclick="switchStudentMainTab('self')">💝 스스로 배움</button>
                    <button class="mini-tab-btn" onclick="switchStudentMainTab('peer')">👥 친구로 배움</button>
                    <button class="mini-tab-btn" onclick="switchStudentMainTab('praise')">💌 칭찬 우체통</button>
                    <button class="mini-tab-btn" onclick="switchStudentMainTab('settings')">⚙️ 설정</button>
                </div> -->

                <!-- 새로운 하단 내비게이션 바 -->
                <nav class="bottom-nav">
                    <button class="nav-item active-nav" onclick="switchStudentMainTab('self')">
                        <span class="nav-icon">💝</span>
                        <span class="nav-label">스스로 배움</span>
                    </button>
                    <button class="nav-item" onclick="switchStudentMainTab('peer')">
                        <span class="nav-icon">👥</span>
                        <span class="nav-label">친구로 배움</span>
                    </button>
                    <button class="nav-item" onclick="switchStudentMainTab('praise')">
                        <span class="nav-icon">💌</span>
                        <span class="nav-label">칭찬 우체통</span>
                    </button>
                    <button class="nav-item" onclick="switchStudentMainTab('settings')">
                        <span class="nav-icon">⚙️</span>
                        <span class="nav-label">설정</span>
                    </button>
                </nav>

                <!-- 배움노트 섹션 -->
                <div id="selfEvaluationSection">
                    <!-- 성향 진단 화면 -->
                    <div id="personalityQuiz" class="hidden">
                        <div class="accent-box box-violet">
                            <span class="box-label">🧠 나의 성장 파트너 찾기</span>
                            <p class="personality-quiz-desc">
                                8개의 질문으로, 나를 더 잘 성장시키는<br>
                                조언 스타일을 찾아요!
                            </p>
                            <div id="quizContent"></div>
                            <button id="submitQuizBtn" class="hidden personality-submit-btn" onclick="submitPersonalityQuiz()">분석 완료</button>
                        </div>
                    </div>

                    <!-- 성향 결과 화면 -->
                    <div id="personalityResult" class="hidden">
                        <div class="accent-box" id="personalityCard">
                            <div class="personality-result-head">
                                <div id="personalityIcon" class="personality-icon-large"></div>
                                <h3 id="personalityTitle" class="personality-title"></h3>
                                <div id="personalityDesc" class="personality-desc"></div>
                            </div>
                            <div id="allPersonalityTypes" class="personality-types-wrap"></div>
                            <div class="personality-result-actions">
                                <button onclick="confirmPersonalityResult()"
                                    class="personality-confirm-btn">확인하고
                                    시작하기</button>
                                <button onclick="resetPersonalityFromSettings()"
                                    class="personality-reset-btn">다시
                                    진단하기</button>
                            </div>
                        </div>
                    </div>

                    <!-- 배움노트 메뉴 -->
                    <div id="selfEvaluationMenu" class="hidden">
                        <div class="sub-tab-container">
                            <button class="sub-tab-btn active" onclick="switchSelfTab('daily')">📝 배움 노트</button>
                            <button class="sub-tab-btn" onclick="switchSelfTab('project')">🌟 프로젝트 돌아보기</button>
                            <button class="sub-tab-btn" onclick="switchSelfTab('dashboard')">📊 결과보기</button>
                        </div>
                        <div class="accent-box box-violet class-tone-section self-date-card">
                            <label>조회/기록 날짜</label>
                            <input type="date" id="selfDate" class="class-tone-input diary-date-input" required
                                onchange="syncAllDates(this.value); loadDailyReflection()">
                        </div>

                        <!-- 배움 노트 탭 -->
                        <div id="dailyReflectionTab">
                            <div class="accent-box box-blue">
                                <span class="box-label">📚 오늘의 배움</span>
                                <div class="guide-buttons guide-scroll-row">
                                    <button type="button" class="template-btn"
                                        onclick="insertTemplate('\uC624\uB298 \uBC30\uC6B4 \uB0B4\uC6A9: \n', 'learningText')">&#x1F4D8; &#xC624;&#xB298; &#xBC30;&#xC6B4; &#xB0B4;&#xC6A9;</button>
                                    <button type="button" class="template-btn"
                                        onclick="insertTemplate('\uB0B4\uAC00 \uC798\uD55C \uC810: \n', 'learningText')">&#x2705; &#xB0B4;&#xAC00; &#xC798;&#xD55C; &#xC810;</button>
                                    <button type="button" class="template-btn"
                                        onclick="insertTemplate('\uC5B4\uB824\uC6E0\uB358 \uC810: \n', 'learningText')">&#x1F635; &#xC5B4;&#xB824;&#xC6E0;&#xB358; &#xC810;</button>
                                    <button type="button" class="template-btn"
                                        onclick="insertTemplate('\uC774\uD574/\uD574\uACB0 \uBC29\uBC95: \n', 'learningText')">&#x1F4A1; &#xC774;&#xD574;/&#xD574;&#xACB0; &#xBC29;&#xBC95;</button>
                                    <button type="button" class="template-btn"
                                        onclick="insertTemplate('\uC544\uC9C1 \uD5F7\uAC08\uB9AC\uB294 \uC810: \n', 'learningText')">&#x2753; &#xC544;&#xC9C1; &#xD5F7;&#xAC08;&#xB9AC;&#xB294; &#xC810;</button>
                                    <button type="button" class="template-btn"
                                        onclick="insertTemplate('\uC77C\uC0C1\uC5D0 \uC801\uC6A9\uD574\uBCFC \uC810: \n', 'learningText')">&#x1F331; &#xC77C;&#xC0C1;&#xC5D0; &#xC801;&#xC6A9;&#xD574;&#xBCFC; &#xC810;</button>

                                </div>
                                <textarea id="learningText"
                                    placeholder="📚 오늘 배운 내용: 국어 토론에서 발표 논리와 표현을 정리하고, 사회 자료를 읽으며 핵심 문장을 표시했어.&#10;✅ 내가 잘한 점: 수학 계산과 과학 실험 기록을 순서대로 정리해서 실수를 줄였고, 영어 문장을 끝까지 읽고 근거를 찾았어.&#10;😵 어려웠던 점: 체육 활동 뒤 집중을 다시 올리는 게 어려웠고, 음악·미술·도덕·실과 내용을 한 번에 연결해 설명하는 게 헷갈렸어.&#10;💡 이해/해결 방법: 모둠활동에서 친구와 역할을 나눠 토론하고, 발표 전에 핵심 키워드 3개를 먼저 적은 뒤 기타 활동 메모까지 붙여 흐름을 맞췄어.&#10;❓ 아직 헷갈리는 점: 자료 근거를 더 짧게 요약해 말하는 연습이 필요해.&#10;🌱 일상에 적용해볼 점: 내일은 태그(국어·수학·사회·과학·영어·음악·미술·체육·도덕·실과·토론·발표·모둠활동·기타)를 기준으로 복습 노트를 만들어볼래."
                                    class="student-note-textarea"></textarea>
                                <label class="subject-tag-label">과목/활동 태그 (여러 개 선택 가능)</label>
                                <div class="subject-tags student-tags-wrap">
                                    <button type="button" class="subject-tag-btn" onclick="toggleSubjectTag('국어')">📖
                                        국어</button>
                                    <button type="button" class="subject-tag-btn" onclick="toggleSubjectTag('수학')">🔢
                                        수학</button>
                                    <button type="button" class="subject-tag-btn" onclick="toggleSubjectTag('사회')">🌍
                                        사회</button>
                                    <button type="button" class="subject-tag-btn" onclick="toggleSubjectTag('과학')">🔬
                                        과학</button>
                                    <button type="button" class="subject-tag-btn" onclick="toggleSubjectTag('영어')">🔤
                                        영어</button>
                                    <button type="button" class="subject-tag-btn" onclick="toggleSubjectTag('음악')">🎵
                                        음악</button>
                                    <button type="button" class="subject-tag-btn" onclick="toggleSubjectTag('미술')">🎨
                                        미술</button>
                                    <button type="button" class="subject-tag-btn" onclick="toggleSubjectTag('체육')">⚽
                                        체육</button>
                                    <button type="button" class="subject-tag-btn" onclick="toggleSubjectTag('도덕')">💛
                                        도덕</button>
                                    <button type="button" class="subject-tag-btn" onclick="toggleSubjectTag('실과')">🔧
                                        실과</button>
                                    <button type="button" class="subject-tag-btn" onclick="toggleSubjectTag('토론')">💬
                                        토론</button>
                                    <button type="button" class="subject-tag-btn" onclick="toggleSubjectTag('발표')">🎤
                                        발표</button>
                                    <button type="button" class="subject-tag-btn" onclick="toggleSubjectTag('모둠활동')">👥
                                        모둠활동</button>
                                    <button type="button" class="subject-tag-btn" onclick="toggleSubjectTag('기타')">✨
                                        기타</button>
                                </div>
                            </div>

                            <button type="button" id="saveDailyBtn" onclick="submitDailyReflection()"
                                class="btn-save-daily">저장하기</button>
                            <div id="dailyMsg" class="message"></div>
                            <div id="aiFeedbackSection" class="hidden ai-feedback-section">
                                <div class="accent-box ai-feedback-card">
                                    <div class="ai-feedback-head">
                                        <span class="ai-feedback-icon">💬</span>
                                        <span class="ai-feedback-title">성장 파트너의
                                            한마디</span>
                                    </div>
                                    <div id="aiFeedbackText" class="ai-feedback-text"></div>
                                </div>
                            </div>
                        </div>

                        <!-- 성장 대시보드 탭 -->
                        <div id="dashboardTab" class="hidden">
                            <div class="accent-box dashboard-overview-card">
                                <span class="box-label">👀 한눈에 보기</span>
                                <div id="streakBadgeArea" class="streak-badge-area dashboard-overview-streak">
                                    <div id="streakDisplay" class="streak-display"></div>
                                    <div id="badgeContainer" class="badge-container-center"></div>
                                </div>
                                <div class="dashboard-overview-divider"></div>
                                <div class="dashboard-overview-keywords">
                                    <div class="dashboard-overview-subtitle">💡 나의 배움 키워드</div>
                                    <div id="learningWordCloud" class="word-cloud">
                                        <div class="empty-state"><span class="empty-icon">💡</span>
                                            <div class="empty-desc">기록이 쌓이면 자주 등장한 키워드가 보여요!</div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="accent-box summary-report-card dashboard-ai-card">
                                <span class="box-label">💬 성장 파트너의 메시지</span>
                                <div class="summary-period-row">
                                    <button type="button" class="summary-period-btn active" data-period="week"
                                        onclick="generatePartnerMessage('week')">📅 이번 주</button>
                                    <button type="button" class="summary-period-btn" data-period="month"
                                        onclick="generatePartnerMessage('month')">📆 이번 달</button>
                                    <button type="button" class="summary-period-btn" data-period="all"
                                        onclick="generatePartnerMessage('all')">🧭 전체</button>
                                </div>
                                <div id="summaryReportArea">
                                    <div class="empty-state"><span class="empty-icon">💬</span>
                                        <div class="empty-desc">기간을 선택해 성장 파트너의 메시지를 받아보세요.</div>
                                    </div>
                                </div>
                                <div class="partner-goal-link-row">
                                    <button type="button" id="partnerMessageGoalBtn" class="partner-goal-link-btn"
                                        onclick="applyPartnerMessageGoal()" disabled>🎯 이걸 목표로 설정!</button>
                                    <div id="partnerMessageGoalHint" class="partner-goal-link-hint">AI 메시지를 먼저 받아보세요.
                                    </div>
                                </div>
                            </div>

                            <details class="accent-box dashboard-history-accordion">
                                <summary class="dashboard-history-summary">
                                    <span class="dashboard-history-title">📊 나의 기록 히스토리</span>
                                    <span class="dashboard-history-state" aria-hidden="true"></span>
                                </summary>
                                <div class="dashboard-history-content">
                                    <div class="dashboard-history-panel">
                                        <div class="dashboard-history-panel-title">과목별 기록</div>
                                        <div id="subjectChart" class="subject-chart">
                                            <div class="empty-state"><span class="empty-icon">📚</span>
                                                <div class="empty-desc">과목 태그를 선택하면 통계가 보여요!</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="dashboard-history-panel">
                                        <div class="dashboard-history-panel-title">기록 캘린더</div>
                                        <div id="recordHeatmap" class="record-heatmap">
                                            <div class="empty-state"><span class="empty-icon">🗓️</span>
                                                <div class="empty-desc">올해 기록을 달력으로 볼 수 있어요.</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="dashboard-history-detail">
                                    <div id="historyFilterSummary" class="history-filter-summary">
                                        <span class="history-filter-placeholder">과목 바 또는 날짜를 선택하면 관련 기록이 표시됩니다.</span>
                                    </div>
                                    <div id="historyDetailList" class="history-detail-list">
                                        <div class="empty-state"><span class="empty-icon">👈</span>
                                            <div class="empty-desc">먼저 과목 또는 날짜를 선택해 주세요.</div>
                                        </div>
                                    </div>
                                </div>
                                <details class="dashboard-history-best">
                                    <summary class="dashboard-history-best-summary">
                                        <span class="dashboard-history-panel-title">나의 베스트 기록</span>
                                        <span class="dashboard-history-best-state" aria-hidden="true"></span>
                                    </summary>
                                    <div class="dashboard-history-best-content">
                                        <div id="bestRecordList" class="best-record-list">
                                            <div class="empty-state"><span class="empty-icon">🏅</span>
                                                <div class="empty-desc">기록이 쌓이면 베스트 기록이 보여요.</div>
                                            </div>
                                        </div>
                                    </div>
                                </details>
                            </details>
                        </div>

                        <div id="projectReflectionTab" class="hidden">
                            <div class="accent-box box-amber">
                                <span class="box-label">🌟 프로젝트 돌아보기</span>
                                <label>프로젝트 이름</label>
                                <input type="text" id="projectName" placeholder="예: 세계 여행 가이드북 만들기">

                                <div class="guide-buttons guide-scroll-row">
                                    <button type="button" class="template-btn"
                                        onclick="insertTemplate('👍 잘된 점: \n', 'projectComment')">👍 잘된 점</button>
                                    <button type="button" class="template-btn"
                                        onclick="insertTemplate('🤔 아쉬운 점/어려웠던 점: \n', 'projectComment')">🤔 아쉬운
                                        점</button>
                                    <button type="button" class="template-btn"
                                        onclick="insertTemplate('✨ 인상적인 순간/배운 점: \n', 'projectComment')">✨
                                        인상/배움</button>

                                    <button type="button" class="template-btn"
                                        onclick="insertTemplate('💪 다음 도전: \n', 'projectComment')">💪 다음 도전</button>
                                    <button type="button" class="template-btn"
                                        onclick="insertTemplate('🎯 다음을 위한 팁: \n', 'projectComment')">🎯 다음 팁</button>
                                </div>
                                <textarea id="projectComment" placeholder="👍 잘된 점: 프로젝트에서 국어·사회 자료를 비교해 핵심을 정리하고, 수학·과학 근거를 넣어 설명 흐름이 또렷했어.&#10;🤔 아쉬운 점/어려웠던 점: 영어 표현, 음악·미술 사례, 체육·도덕·실과 연결 포인트를 한 번에 담으려다 문장이 길어졌어.&#10;✨ 인상적인 순간/배운 점: 토론으로 의견을 모으고 모둠활동 발표에서 역할을 나눴더니 전달이 훨씬 안정적이었어.&#10;💪 다음 도전: 기타 자료까지 포함해 태그(국어·수학·사회·과학·영어·음악·미술·체육·도덕·실과·토론·발표·모둠활동·기타)를 모두 반영한 1페이지 요약본을 만들래.&#10;🎯 다음을 위한 팁: 슬라이드마다 결론 한 줄 → 근거 두 줄 순서로 고정하면 메시지가 더 선명해져."
                                    class="student-note-textarea"></textarea>
                            </div>
                            <button type="button" id="submitProjectBtn" onclick="submitProjectReflection()"
                                class="btn-project-submit">제출</button>
                            <div id="projectMsg" class="message"></div>
                            <div id="projectAIAnalysis" class="hidden ai-encouragement">
                                <div class="ai-icon">🤖</div>
                                <div id="projectAIText"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 친구로 배움 섹션 -->
                <div id="peerEvaluationSection" class="hidden">
                    <div class="sub-tab-container">
                        <button class="sub-tab-btn active" onclick="switchPeerTab('submit')">📝 평가하기</button>
                        <button class="sub-tab-btn" onclick="switchPeerTab('result')">📊 결과보기</button>
                    </div>
                    <div id="studentSubmitTab">
                        <form id="reviewForm">
                            <label>평가 날짜</label>
                            <input type="date" id="reviewDate" class="class-tone-input diary-date-input" required
                                onchange="syncAllDates(this.value)">
                            <div class="type-selector">
                                <label><input type="radio" name="evalTypeDisplay" value="individual"
                                        onchange="switchTypeAndLogout('individual')"> 👤 개인평가</label>
                                <label><input type="radio" name="evalTypeDisplay" value="group"
                                        onchange="switchTypeAndLogout('group')"> 👥 모둠평가</label>
                            </div>
                            <div class="accent-box box-blue">
                                <span class="box-label">🎯 학습 목표 및 평가 과제</span>
                                <div id="objectiveArea" class="objective-area">
                                    <div class="objective-label">
                                        학습 목표</div>
                                    <div id="objectiveText" class="objective-text">등록된 학습목표가 없습니다.</div>
                                </div>
                                <div id="taskArea" class="task-area">
                                    <div class="objective-label">
                                        평가 과제</div>
                                    <div id="taskText" class="objective-text">등록된 평가과제가 없습니다.</div>
                                </div>
                            </div>
                            <div class="accent-box box-teal">
                                <span class="box-label">📝 평가 정보 입력</span>
                                <label id="submitReviewerLabel">나의 번호</label>
                                <input type="text" id="reviewerId" readonly class="reviewer-input-readonly">
                                <label id="submitTargetLabel">평가 대상 선택</label>
                                <div id="progressArea" class="progress-area">
                                    <div class="progress-text" id="progressText">평가 진행: 0 / 0명</div>
                                    <div class="progress-bar-container">
                                        <div class="progress-bar-fill progress-bar-zero" id="progressBar"></div>
                                    </div>
                                </div>
                                <div id="targetGrid" class="target-grid"></div>
                                <input type="hidden" id="targetId">
                            </div>
                            <div id="ratingSection" class="accent-box box-amber hidden">
                                <span class="box-label">평가 기준</span>
                                <div id="ratingItems"></div>
                            </div>
                            <div class="accent-box box-green">
                                <span class="box-label">💬 서로의 발전을 돕는 피드백</span>
                                <div class="feedback-templates guide-scroll-row">
                                    <button type="button" class="template-btn"
                                        onclick="insertTemplate('👍 잘한 점: \n')">👍
                                        잘한 점</button>
                                    <button type="button" class="template-btn"
                                        onclick="insertTemplate('💡 이렇게 하면 더 좋을 것 같아: \n')">💡 개선 제안</button>
                                    <button type="button" class="template-btn"
                                        onclick="insertTemplate('✨ 특히 인상적이었던 부분은 \n')">✨ 인상적인 부분</button>
                                    <button type="button" class="template-btn"
                                        onclick="insertTemplate('💪 다음에는 이런 점을 시도해보면 좋겠어: \n')">💪 다음 도전</button>
                                </div>
                                <textarea id="reviewContent"
                                    placeholder="👍 잘한 점: 국어·토론·발표에서 핵심을 먼저 말하고, 사회·과학 근거를 붙여서 듣는 사람이 이해하기 쉬웠어.&#10;💡 이렇게 하면 더 좋을 것 같아: 수학·영어 표현을 한 줄 더 보완하고, 음악·미술 예시를 짧게 넣으면 메시지가 더 풍부해질 것 같아.&#10;✨ 특히 인상적이었던 부분은: 체육·도덕·실과 활동 내용을 모둠활동으로 연결해 역할 분담을 끝까지 지킨 점이 좋았어.&#10;💪 다음에는 이런 점을 시도해보면 좋겠어: 기타 자료까지 포함해 태그(국어·수학·사회·과학·영어·음악·미술·체육·도덕·실과·토론·발표·모둠활동·기타)를 체크한 뒤 피드백을 작성해봐." required
                                    minlength="100" oninput="updateCharCount()"
                                    class="review-content-textarea"></textarea>
                                <div id="charCount" class="char-count-right">
                                    0자 /
                                    최소 100자</div>
                            </div>
                            <button type="submit" id="submitBtn" class="not-ready">평가 제출하기</button>
                        </form>
                        <div id="submitMsg" class="message"></div>
                    </div>
                    <div id="studentResultTab" class="hidden">
                        <div class="type-selector type-selector-gap-20">
                            <label><input type="radio" name="resultEvalTypeDisplay" value="individual"
                                    onchange="switchTypeAndLogout('individual')"> 👤 개인평가</label>
                            <label><input type="radio" name="resultEvalTypeDisplay" value="group"
                                    onchange="switchTypeAndLogout('group')"> 👥 모둠평가</label>
                        </div>
                        <div class="accent-box box-amber class-tone-section">
                            <span class="box-label">결과 조회</span>
                            <label>조회 날짜</label>
                            <input type="date" id="viewDate" class="class-tone-input diary-date-input" required
                                onchange="syncAllDates(this.value)">
                            <button type="button" id="viewResultBtn" onclick="viewMyResult()">💬 성장 파트너의 메시지 받기</button>
                        </div>
                        <div id="viewMsg" class="message"></div>
                        <div id="resultArea" class="hidden result-area-gap">
                            <div id="statsSummary" class="stats-summary"></div>
                            <div id="chartContainer" class="chart-container hidden">
                                <h4>📊 항목별 점수 현황</h4>
                                <div id="barChart" class="bar-chart"></div>
                            </div>
                            <div class="accent-box box-violet">
                                <span class="box-label summary-title-gap">💬 성장 파트너의 메시지</span>
                                <div id="mySummary" class="summary-text-main"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 우체통 섹션 -->
                <div id="praiseSection" class="hidden">
                    <div class="sub-tab-container sub-tab-gap-20">
                        <button class="sub-tab-btn active" onclick="switchPraiseTab('send')">💌 칭찬 보내기</button>
                        <button class="sub-tab-btn" onclick="switchPraiseTab('received')">📬 받은 칭찬</button>
                        <button class="sub-tab-btn" onclick="switchPraiseTab('teacher')">💌 선생님께 편지</button>
                    </div>
                    <div id="praiseSendTab">
                        <div class="accent-box class-tone-section">
                            <span class="box-label">💌 친구에게 칭찬 보내기</span>
                            <label>받는 친구 번호</label>
                            <div id="praiseTargetGrid" class="target-grid target-grid-gap"></div>
                            <input type="hidden" id="praiseTargetId">
                            <div class="type-selector type-selector-gap-10">
                                <label><input type="radio" name="praiseAnon" value="anonymous" checked> 🎭 익명</label>
                                <label><input type="radio" name="praiseAnon" value="named"> 😊 이름 밝히기</label>
                            </div>
                            <textarea id="praiseContent" placeholder="친구에게 전하고 싶은 칭찬이나 감사의 말을 써주세요! (최소 10자)"
                                minlength="10" class="textarea-gap-5" oninput="updatePraiseCharCount()"></textarea>
                            <div id="praiseCharCount"
                                class="char-count-right">0자 / 최소 10자</div>
                            <button type="button" id="praiseSendBtn" onclick="sendPraise()">칭찬 보내기 💝</button>
                            <div id="praiseMsg" class="message"></div>
                        </div>
                    </div>
                    <div id="praiseReceivedTab" class="hidden">
                        <div class="accent-box box-violet">
                            <span class="box-label">📬 나에게 온 칭찬</span>
                            <div id="receivedPraiseList">
                                <div class="empty-state"><span class="empty-icon">💌</span>
                                    <div class="empty-title">아직 받은 칭찬이 없어요</div>
                                    <div class="empty-desc">친구들의 칭찬이 도착하면<br>여기에 표시됩니다!</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- 선생님께 편지 탭 -->
                    <div id="teacherMessageTab" class="hidden">
                        <div class="accent-box box-teal teacher-message-box-flat" id="teacherMessageBox">
                            <span class="box-label">💬 선생님께 전하고 싶은 말</span>
                            <div class="message-mode-selector">
                                <button type="button" class="mode-btn" id="anonymousBtn"
                                    onclick="toggleMessageMode('anonymous')">
                                    익명으로
                                </button>
                                <button type="button" class="mode-btn" id="namedBtn"
                                    onclick="toggleMessageMode('named')">
                                    이름 밝히고
                                </button>
                            </div>
                            <div id="messageInputArea" class="hidden message-input-gap">
                                <div id="messageModeBadge" class="message-mode-badge">
                                </div>
                                <textarea id="teacherMessage" placeholder="선생님께 하고 싶은 말을 자유롭게 써보세요"
                                    class="teacher-message-textarea"></textarea>
                                <div class="message-input-actions">

                                    <button type="button" id="sendTeacherMsgBtn" onclick="submitTeacherMessageOnly()"
                                        class="teacher-msg-send-btn">보내기</button>
                                </div>
                                <div id="teacherMsgResult" class="message"></div>
                            </div>
                        </div>

                    </div>
                </div>

                <!-- 학생 설정 섹션 -->
                <div id="studentSettingsSection" class="hidden">
                    <!-- 박스 1: 나의 학급 정보 -->
                    <div class="accent-box student-settings-card">
                        <span class="box-label">📚 나의 학급 정보</span>
                        <div class="student-settings-stack">
                            <div class="student-class-info-row">
                                <span class="student-class-info-key">학급명</span>
                                <span id="settingsClassName" class="student-class-info-value">-</span>
                            </div>
                            <div class="student-class-info-row">
                                <span class="student-class-info-key">학급 코드</span>
                                <span id="settingsClassCode" class="student-class-info-value">-</span>
                            </div>
                        </div>
                    </div>

                    <!-- 박스 2: 나의 성장 파트너 (성향 진단) -->
                    <div class="accent-box student-settings-card">
                        <span class="box-label">🧠 나의 성장 파트너</span>
                        <div id="settingsPersonalityArea" class="settings-personality-area">
                            <p class="settings-personality-loading">로딩 중...</p>
                        </div>
                    </div>

                    <!-- 박스 3: 학급 변경 -->
                    <div class="accent-box class-tone-section student-class-change-card">
                        <span class="box-label">🔄 학급 변경</span>
                        <p class="student-class-change-warning">
                            ⚠️ 학급을 변경하면 기존 데이터(일기, 평가, 칭찬 등)가 <strong>모두 삭제</strong>됩니다.
                        </p>
                        <div class="student-class-change-field">
                            <label>새 학급명</label>
                            <input type="text" id="newClassNameInput" placeholder="이동할 학급명 입력 (예: 부평서초6-1)"
                                class="student-class-change-input">
                        </div>
                        <div class="student-class-change-field">
                            <label>새 학급 코드</label>
                            <input type="text" id="newClassCodeInput" placeholder="이동할 학급 코드 입력"
                                class="student-class-change-input">
                        </div>
                        <button type="button" onclick="changeClassAndReset()"
                            class="student-class-change-btn">학급 변경하기</button>
                    </div>
                </div>
            </div>

        </div>

        <!-- 교사 메인 (기존 사용자 / 온보딩 후) -->
        <div id="teacherTab" class="hidden">
            <h1 class="app-title">
                <img class="floating-emoji app-brand-icon" src="images/Gemini_Generated_Image_d19ctrd19ctrd19c-removebg-preview.png" alt="배움로그 아이콘">
                <span class="app-title-text">배움로그</span>
            </h1>
            <div id="teacherMain" class="hidden">
                <div class="teacher-top-actions">
                    <button onclick="logoutGoogle()"
                        class="teacher-logout-btn">로그아웃</button>
                </div>
                <!-- 새로운 하단 내비게이션 바 (교사용) -->
                <nav class="bottom-nav teacher-bottom-nav">
                    <button class="nav-item active-nav" onclick="switchMiniTab('diary')">
                        <span class="nav-icon">💝</span>
                        <span class="nav-label">스스로 배움</span>
                    </button>
                    <button class="nav-item" onclick="switchMiniTab('review')">
                        <span class="nav-icon">👥</span>
                        <span class="nav-label">친구로 배움</span>
                    </button>
                    <button class="nav-item" onclick="switchMiniTab('praise')">
                        <span class="nav-icon">💌</span>
                        <span class="nav-label">칭찬 우체통</span>
                    </button>
                    <button class="nav-item" onclick="switchMiniTab('settings')">
                        <span class="nav-icon">👤</span>
                        <span class="nav-label">학급 관리</span>
                    </button>
                </nav>
                <!-- 친구로 배움 하위 탭 -->
                <div id="reviewSubTabArea" class="hidden">
                    <div class="sub-tab-container sub-tab-gap-15">
                        <button class="sub-tab-btn active" onclick="switchReviewSubTab('ranking')">📊 전체 현황</button>
                        <button class="sub-tab-btn" onclick="switchReviewSubTab('student')">👤 개별 현황</button>
                        <button class="sub-tab-btn" onclick="switchReviewSubTab('criteria')">📅 기준 설정</button>
                    </div>
                </div>
                <div id="rankStudentArea" class="accent-box box-violet rank-student-area-card">
                    <div class="stats-filter-container rank-filter-row">
                        <div class="rank-filter-date-wrap">
                            <label class="diary-date-label">📅 조회 날짜</label>
                            <input type="date" id="teacherDate" class="class-tone-input diary-date-input" required
                                onchange="syncAllDates(this.value); loadTeacherData()">
                        </div>
                        <div class="type-selector rank-filter-type-selector">
                            <label class="rank-filter-option-label">
                                <input type="radio" name="teacherEvalType" value="individual" checked
                                    onchange="loadTeacherData()"> 👤 개인</label>
                            <label class="rank-filter-option-label">
                                <input type="radio" name="teacherEvalType" value="group" onchange="loadTeacherData()">
                                👥 모둠</label>
                        </div>
                    </div>
                </div>
                <div id="rankingMiniTab">
                    <div id="teacherDashboard" class="stats-summary teacher-dashboard-gap"></div>
                    <h3>친구로배움 현황 (내림차순)</h3>
                    <div class="ranking-table-wrapper ranking-table-scroll">
                        <div id="rankingTable"></div>
                    </div>
                </div>
                <div id="studentMiniTab" class="hidden">
                    <h3>대상 번호 선택</h3>
                    <div id="studentSelector" class="student-selector"></div>
                    <div id="studentReviews"></div>
                </div>
                <div id="diaryMiniTab" class="hidden">
                    <div class="sub-tab-container sub-tab-gap-15">
                        <button type="button" class="sub-tab-btn active" onclick="switchTeacherDiarySubTab('overview')">📊 참여현황</button>
                        <button type="button" class="sub-tab-btn" onclick="switchTeacherDiarySubTab('student')">📝 개별보기</button>
                        <button type="button" class="sub-tab-btn" onclick="switchTeacherDiarySubTab('comment')">🧑‍🏫 세특생성</button>
                    </div>

                    <div id="teacherDiaryOverviewTab">
                    <div class="accent-box box-violet">
                        <span class="box-label">📊 배움노트 참여 현황</span>
                        <div class="diary-date-filter-wrap">
                            <label class="diary-date-label">📅 조회 날짜</label>
                            <input type="date" id="diaryViewDate" class="class-tone-input diary-date-input"
                                onchange="handleTeacherDiaryDateChange('diaryViewDate')">
                        </div>
                        <div class="stats-summary diary-overview-stats">
                            <div class="stat-card">
                                <span class="stat-number" id="totalReflections">0</span>
                                <span class="stat-label">총 작성 수</span>
                            </div>
                            <div class="stat-card blue">
                                <span class="stat-number" id="todayReflections">0</span>
                                <span class="stat-label">선택 날짜 작성</span>
                            </div>
                        </div>
                        <div class="diary-completion-wrap">
                            <span class="box-label diary-completion-label">🧾 배움노트 제출 확인</span>
                            <div id="diaryCompletionSummary" class="diary-completion-summary"></div>
                            <div id="diaryCompletionList" class="diary-completion-list"></div>
                        </div>
                    </div>
                    </div>

                    <div id="teacherDiaryStudentTab" class="hidden">
                    <div class="accent-box box-teal">
                        <span class="box-label">👤 개별 배움노트</span>
                        <div class="diary-date-filter-wrap">
                            <label class="diary-date-label">📅 조회 날짜</label>
                            <input type="date" id="diaryStudentViewDate" class="class-tone-input diary-date-input"
                                onchange="handleTeacherDiaryDateChange('diaryStudentViewDate')">
                        </div>
                        <div class="diary-student-selector-wrap">
                            <label class="form-label">학생 번호 선택</label>
                            <div id="diaryStudentSelectorList" class="diary-student-selector-grid"></div>
                        </div>
                        <div id="diaryStudentDetail" class="diary-student-detail">
                            <div class="empty-state">
                                <span class="empty-icon">📝</span>
                                <div class="empty-desc">학생 번호를 누르면 해당 학생이 오늘 쓴 배움노트를 볼 수 있습니다.</div>
                            </div>
                        </div>
                    </div>
                    <div id="emotionAlertArea" class="accent-box box-violet hidden">
                        <span class="box-label">🗂️ 어려움 모아보기</span>
                        <p class="emotion-alert-desc">
                            선택 날짜의 배움노트에서 <strong>기록된 어려움</strong>을 모아 보여줍니다. (클릭하면 해당 학생 노트로 이동)
                        </p>
                        <div id="emotionAlertList"></div>
                    </div>

                    <!-- 교과세특(평어) 생성: 배움노트 기반 -->
                    </div>

                    <div id="teacherDiaryCommentTab" class="hidden">
                    <div id="teacherSubjectCommentSection" class="teacher-subject-comment-card">
                        <span class="box-label">🧑‍🏫 배움노트 기반 교과세특 (평어) 생성</span>
                        <p class="teacher-subject-comment-desc">
                            학생이 한 학기 동안 쓴 배움노트를 근거로, 생활기록부 속 교과 세부 특기 사항 문장을 생성합니다.
                        </p>

                        <div class="teacher-subject-comment-settings">
                            <div class="teacher-subject-comment-row teacher-subject-comment-row-single teacher-subject-comment-row-student">
                                <div class="teacher-subject-comment-field">
                                    <label class="form-label">현재 선택 학생</label>
                                    <div id="teacherSubjectCommentStudentPicker" class="teacher-subject-comment-student-picker">
                                        <button type="button" id="teacherSubjectCommentStudent" class="teacher-subject-comment-pill teacher-subject-comment-student-trigger" onclick="toggleTeacherSubjectCommentStudentMenu()">미선택</button>
                                        <div id="teacherSubjectCommentStudentMenu" class="teacher-subject-comment-student-menu hidden"></div>
                                    </div>
                                </div>
                            </div>

                            <div class="teacher-subject-comment-row teacher-subject-comment-row-half teacher-subject-comment-row-settings">
                                <div class="teacher-subject-comment-field">
                                    <label class="form-label">학교급</label>
                                    <select id="teacherSubjectCommentSchoolLevel" class="class-tone-input teacher-subject-comment-input">
                                        <option value="">선택하세요</option>
                                        <option value="초">초</option>
                                        <option value="중">중</option>
                                        <option value="고">고</option>
                                    </select>
                                </div>
                                <div class="teacher-subject-comment-field">
                                    <label class="form-label">학기</label>
                                    <div class="teacher-subject-comment-seg">
                                        <button type="button" id="teacherSubjectCommentSemester1" class="seg-btn active" onclick="setTeacherSubjectCommentSemester(1)">1학기</button>
                                        <button type="button" id="teacherSubjectCommentSemester2" class="seg-btn" onclick="setTeacherSubjectCommentSemester(2)">2학기</button>
                                    </div>
                                </div>
                            </div>

                            <div class="teacher-subject-comment-row teacher-subject-comment-row-half teacher-subject-comment-row-period">
                                <div class="teacher-subject-comment-field">
                                    <label class="form-label">기간 시작일</label>
                                    <input type="date" id="teacherSubjectCommentStart" class="class-tone-input teacher-subject-comment-input">
                                </div>
                                <div class="teacher-subject-comment-field">
                                    <label class="form-label">기간 종료일</label>
                                    <input type="date" id="teacherSubjectCommentEnd" class="class-tone-input teacher-subject-comment-input">
                                </div>
                            </div>

                            <div class="teacher-subject-comment-row teacher-subject-comment-row-single teacher-subject-comment-row-tags">
                                <div class="teacher-subject-comment-field">
                                    <label class="form-label">과목 태그 (1개 선택)</label>
                                    <div id="teacherSubjectCommentSubjectTags" class="subject-tags teacher-subject-comment-tags"></div>
                                    <div id="teacherSubjectCommentCustomSubjectWrap" class="teacher-subject-comment-custom-wrap hidden">
                                        <input type="text" id="teacherSubjectCommentCustomSubjectInput" class="class-tone-input teacher-subject-comment-input" placeholder="기타 과목명 입력 (예: 물리, 지리, 프로그래밍)">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="teacher-subject-comment-actions">
                            <button type="button" id="teacherSubjectCommentPreviewBtn" class="teacher-subject-comment-btn teacher-subject-comment-btn-secondary" onclick="previewTeacherSubjectCommentSources()">조회하기</button>
                            <button type="button" id="teacherSubjectCommentGenerateBtn" class="teacher-subject-comment-btn teacher-subject-comment-btn-primary" onclick="generateTeacherSubjectComment(false)">생성하기</button>
                            <div class="teacher-subject-comment-action-row">
                                <button type="button" id="teacherSubjectCommentRegenerateBtn" class="teacher-subject-comment-btn teacher-subject-comment-btn-secondary" onclick="generateTeacherSubjectComment(true)">재생성</button>
                                <button type="button" id="teacherSubjectCommentSaveBtn" class="teacher-subject-comment-btn teacher-subject-comment-btn-secondary" onclick="saveTeacherSubjectComment(this)">저장</button>
                            </div>
                            <div class="teacher-subject-comment-action-row">
                                <button type="button" id="teacherSubjectCommentCopyBtn" class="teacher-subject-comment-btn teacher-subject-comment-btn-utility" onclick="copyTeacherSubjectComment()">복사</button>
                                <button type="button" id="teacherSubjectCommentExportBtn" class="teacher-subject-comment-btn teacher-subject-comment-btn-utility" onclick="openTeacherSubjectCommentExportModal()">.xlsx 다운로드</button>
                            </div>
                        </div>

                        <div id="teacherSubjectCommentResultWrap" class="teacher-subject-comment-result-wrap">
                            <div class="teacher-subject-comment-meta">
                                <span>배움노트 <strong id="teacherSubjectCommentNoteCount">-</strong>건</span>
                                <span id="teacherSubjectCommentStatus" class="teacher-subject-comment-status"></span>
                            </div>
                            <div id="teacherSubjectCommentSourceWrap" class="hidden teacher-subject-comment-source-wrap">
                                <div class="teacher-subject-comment-source-head">📚 선택 과목 원문 조회</div>
                                <div id="teacherSubjectCommentSourceList" class="teacher-subject-comment-source-list"></div>
                            </div>
                            <div id="teacherSubjectCommentEmpty" class="empty-state teacher-subject-comment-empty">
                                <span class="empty-icon">📚</span>
                                <div class="empty-title">설정을 선택해 생성해보세요</div>
                                <div class="empty-desc">학생/학기/기간/과목/학교급을 선택한 후 생성하기를 눌러주세요.</div>
                            </div>
                            <pre id="teacherSubjectCommentResult" class="teacher-subject-comment-result hidden"></pre>
                            <div id="teacherSubjectCommentError" class="message error teacher-subject-comment-error"></div>
                            <div id="teacherSubjectCommentRetry" class="hidden teacher-subject-comment-retry">
                                <button type="button" class="teacher-subject-comment-btn teacher-subject-comment-btn-secondary teacher-subject-comment-retry-btn" onclick="generateTeacherSubjectComment(true)">다시 시도</button>
                            </div>
                        </div>
                    </div>
                    </div>
                </div>
                <div id="praiseMiniTab" class="hidden">
                    <div class="sub-tab-container sub-tab-gap-15">
                        <button id="teacherPraiseManageBtn" class="sub-tab-btn active"
                            onclick="switchTeacherPraiseSubTab('praise')">칭찬 관리</button>
                        <button id="teacherLetterManageBtn" class="sub-tab-btn"
                            onclick="switchTeacherPraiseSubTab('letter')">편지 관리</button>
                    </div>
                    <div id="teacherPraiseManagePanel">
                    <!-- 자동 승인 설정 -->
                    <div class="accent-box praise-approval-card">
                        <div class="praise-approval-head">
                            <span class="praise-approval-icon">✨</span>
                            <div>
                                <div class="praise-approval-title">칭찬 자동 승인 모드
                                </div>
                                <div class="praise-approval-desc">활성화하면 학생들의 칭찬이 대기 없이 즉시
                                    전달됩니다.
                                </div>
                            </div>
                        </div>
                        <label class="switch-container">
                            <input type="checkbox" id="autoApproveToggle" onchange="toggleAutoApprovePraise(this)">
                            <span class="switch-slider"></span>
                        </label>
                    </div>
                    <!-- 통계 요약 -->
                    <div id="praiseStatsArea" class="praise-stats-container">
                        <div class="praise-stat-card is-total">
                            <div class="praise-stat-value" id="praiseTotalCount">-
                            </div>
                            <div class="praise-stat-label">전체 칭찬</div>
                        </div>
                        <div class="praise-stat-card is-pending">
                            <div class="praise-stat-value" id="praisePendingCount">-
                            </div>
                            <div class="praise-stat-label">대기 중</div>
                        </div>
                        <div class="praise-stat-card is-approved">
                            <div class="praise-stat-value" id="praiseApprovedCount">
                                -
                            </div>
                            <div class="praise-stat-label">승인 완료</div>
                        </div>
                    </div>
                    <!-- 대기 중인 칭찬 -->
                    <div id="diaryParticipationCard" class="accent-box box-violet">
                        <span class="box-label">⏳ 승인 대기 중인 칭찬</span>
                        <div id="pendingPraiseList">
                            <div class="empty-state"><span class="empty-icon">💌</span>
                                <div class="empty-desc">대기 중인 칭찬이 없습니다</div>
                            </div>
                        </div>
                    </div>
                    <!-- 승인된 칭찬 전체 목록 -->
                    <div class="accent-box box-violet">
                        <span class="box-label">✅ 승인된 칭찬 목록</span>
                        <div id="approvedPraiseList">
                            <div class="empty-state"><span class="empty-icon">📬</span>
                                <div class="empty-desc">승인된 칭찬이 없습니다</div>
                            </div>
                        </div>
                    </div>
                    </div>
                    <div id="teacherLetterManagePanel" class="hidden">
                    <!-- 학생 메시지 (배움노트에서 이전) -->
                    <div class="accent-box box-teal">
                        <span class="box-label">💬 학생 메시지</span>
                        <div class="teacher-message-date-wrap">
                            <label class="teacher-message-date-label">📅 조회
                                날짜</label>
                            <input type="date" id="messageViewDate" class="class-tone-input teacher-message-date-input"
                                onchange="loadTeacherMessages()">
                        </div>
                        <div id="messageList" class="teacher-message-list">
                            <div class="empty-state">
                                <span class="empty-icon">💌</span>
                                <div class="empty-title">메시지가 없습니다</div>
                                <div class="empty-desc">날짜를 선택하면<br>학생들의 메시지를 볼 수 있습니다.</div>
                            </div>
                        </div>
                    </div>
                    </div>
                </div>
                <div id="criteriaMiniTab" class="hidden">
                    <div class="accent-box box-teal">
                        <span class="box-label">📅 날짜별 기준 설정</span>
                        <div
                            style="background:rgba(255,255,255,0.5); padding:15px; border-radius:10px; border:1px solid var(--border);">
                            <label style="display:block; margin-bottom:8px; font-family:'Jua', sans-serif;">📅 설정할
                                날짜</label>
                            <input type="date" id="settingDate"
                                style="width:100%; font-family:'Jua', sans-serif !important; font-size:1.05rem; margin-bottom:15px;"
                                onchange="syncAllDates(this.value); loadCriteriaForEdit()">
                            <label>🎯 학습 목표</label><input type="text" id="settingObjective"
                                placeholder="예: 세계의 다양한 기후와 지형에 따른 사람들의 생활 모습을 조사할 수 있다.">
                            <label>📋 평가 과제</label><input type="text" id="settingTask"
                                placeholder="예: 자신이 선택한 나라의 생활 모습을 조사하여 여행 가이드북 만들어 발표하기">
                            <button type="button" onclick="saveBasicInfo(this)" class="save-basic-btn">💾 1단계: 학습목표
                                및
                                평가과제 저장하기</button>
                            <p style="font-size:0.8rem; color:var(--text-sub); margin-top:-15px; text-align:center;">
                                ⚠️
                                평가기준을 AI로 생성하려면 이 버튼을 먼저 눌러 저장해야 합니다.</p>
                        </div>
                        <hr style="border:0; border-top:2px dashed var(--border); margin:25px 0;">
                        <div class="criteria-mode-header"
                            style="display:flex; justify-content:space-between; align-items:flex-end; margin-top:20px; margin-bottom:10px;">
                            <label style="margin:0; padding-bottom:5px;">📊 평가기준 설정 (2단계)</label>
                            <div class="mini-tab-container"
                                style="margin:0; padding:4px; max-width:280px; width:100%; display:flex; gap:5px;">
                                <button type="button" class="mini-tab-btn active-setting"
                                    onclick="switchCriteriaMode('auto')" id="autoModeBtn"
                                    style="flex:1; font-size:0.85rem; padding:8px 0;">✨ AI로 생성하기</button>
                                <button type="button" class="mini-tab-btn" onclick="switchCriteriaMode('manual')"
                                    id="manualModeBtn" style="flex:1; font-size:0.85rem; padding:8px 0;">✏️ 수동
                                    작성하기</button>
                            </div>
                        </div>
                        <div id="autoCriteriaArea">
                            <div
                                style="background:var(--bg-soft); padding:15px; border-radius:10px; margin-bottom:15px; border:1px solid var(--border);">
                                <div style="display:flex; gap:10px; margin-bottom:10px;">
                                    <div style="flex:1;"><label style="font-size:0.8rem;">학교급</label><select
                                            id="autoSchoolLevel" style="margin-bottom:0;"
                                            onchange="updateGradeOptions()">
                                            <option value="초등학교" selected>초등학교</option>
                                            <option value="중학교">중학교</option>
                                            <option value="고등학교">고등학교</option>
                                        </select></div>
                                    <div style="flex:1;"><label style="font-size:0.8rem;">학년</label><select
                                            id="autoGradeSelect" style="margin-bottom:0;">
                                            <option value="1학년">1학년</option>
                                            <option value="2학년">2학년</option>
                                            <option value="3학년">3학년</option>
                                            <option value="4학년">4학년</option>
                                            <option value="5학년" selected>5학년</option>
                                            <option value="6학년">6학년</option>
                                        </select></div>
                                    <div style="flex:1;"><label style="font-size:0.8rem;">평가 대상</label><select
                                            id="autoTargetSelect" style="margin-bottom:0;">
                                            <option value="individual">개인 평가</option>
                                            <option value="group">모둠 평가</option>
                                        </select></div>
                                </div>
                                <button type="button" onclick="generateCriteriaAI(this)"
                                    style="background:linear-gradient(135deg, #9575CD 0%, #7E57C2 100%); width:100%;">🤖
                                    2단계: AI로 기준 자동 생성하기</button>
                            </div>
                            <div id="autoResultInputs">
                                <div style="margin-bottom:12px;"><label
                                        style="font-size:0.85rem; color:var(--color-blue);">① 지식・이해</label><input
                                        type="text" id="autoRate1" placeholder="AI 결과 1" style="margin-bottom:5px;"
                                        readonly disabled><input type="text" id="autoRate2" placeholder="AI 결과 2"
                                        style="margin-bottom:0;" readonly disabled></div>
                                <div style="margin-bottom:12px;"><label
                                        style="font-size:0.85rem; color:var(--color-teal);">② 과정・기능</label><input
                                        type="text" id="autoRate3" placeholder="AI 결과 3" style="margin-bottom:5px;"
                                        readonly disabled><input type="text" id="autoRate4" placeholder="AI 결과 4"
                                        style="margin-bottom:0;" readonly disabled></div>
                                <div style="margin-bottom:12px;"><label
                                        style="font-size:0.85rem; color:var(--color-teacher);">③ 가치・태도</label><input
                                        type="text" id="autoRate5" placeholder="AI 결과 5" style="margin-bottom:5px;"
                                        readonly disabled><input type="text" id="autoRate6" placeholder="AI 결과 6"
                                        style="margin-bottom:0;" readonly disabled></div>
                            </div>
                        </div>
                        <div id="manualCriteriaArea" class="hidden">
                            <div style="margin-bottom:15px;">
                                <div
                                    style="font-weight:700; color:var(--color-blue); font-size:0.9rem; margin-bottom:8px;">
                                    ① 지식・이해</div><input type="text" id="settingRate1" placeholder="기준 1"
                                    style="margin-bottom:8px;"><input type="text" id="settingRate2" placeholder="기준 2"
                                    style="margin-bottom:0;">
                            </div>
                            <div style="margin-bottom:15px;">
                                <div
                                    style="font-weight:700; color:var(--color-teal); font-size:0.9rem; margin-bottom:8px;">
                                    ② 과정・기능</div><input type="text" id="settingRate3" placeholder="기준 1"
                                    style="margin-bottom:8px;"><input type="text" id="settingRate4" placeholder="기준 2"
                                    style="margin-bottom:0;">
                            </div>
                            <div style="margin-bottom:15px;">
                                <div
                                    style="font-weight:700; color:var(--color-teacher); font-size:0.9rem; margin-bottom:8px;">
                                    ③ 가치・태도</div><input type="text" id="settingRate5" placeholder="기준 1"
                                    style="margin-bottom:8px;"><input type="text" id="settingRate6" placeholder="기준 2"
                                    style="margin-bottom:0;">
                            </div>
                        </div>
                        <button onclick="saveDailyCriteria(this)"
                            style="background:var(--color-teal); margin-top:20px;">💾
                            3단계: 평가기준 저장하기</button>
                    </div>
                </div>
                <div id="settingsMiniTab" class="hidden">
                    <div id="classInfoCard" class="accent-box box-amber class-tone-section">
                        <span class="box-label">📋 우리 학급 정보</span>
                        <div class="settings-two-col" style="display:flex; gap:15px; margin-bottom:15px;">
                            <div class="settings-field" style="flex:1;"><label>학급명</label><input type="text" id="settingClassName" class="class-tone-input"
                                    placeholder="예: 부평서초6-1" style="font-family:'Jua', sans-serif !important;">
                            </div>
                            <div class="settings-field" style="flex:1;"><label>클래스 코드</label><input type="text" id="settingClassCode" class="class-tone-input"
                                    placeholder="예: 부평서초34" style="font-family:'Jua', sans-serif !important;"></div>
                        </div>
                        <button onclick="saveClassInfo(this)" style="background:var(--color-result);">💾 학급 정보
                            저장하기</button>
                        <p style="font-size:0.8rem; color:var(--text-sub); margin-top:10px; text-align:center;">※
                            클래스 코드를 변경하면 학생들도 새로운 코드로 접속해야 합니다. (띄어쓰기 금지)</p>
                    </div>
                    <div id="classCompositionCard" class="accent-box box-violet class-tone-section">
                        <span class="box-label">🏫 우리 반 구성 설정</span>
                        <div id="classCompositionFields" class="settings-two-col" style="display:flex; gap:15px; margin-bottom:15px;">
                            <div class="settings-field" style="flex:1;"><label>👤 학생 수</label><input type="number" id="settingStudentCount" class="class-tone-input"
                                    min="1" max="50" placeholder="30" style="font-family:'Jua', sans-serif !important;">
                            </div>
                            <div class="settings-field" style="flex:1;"><label>👥 모둠 수</label><input type="number" id="settingGroupCount" class="class-tone-input"
                                    min="1" max="20" placeholder="6" style="font-family:'Jua', sans-serif !important;">
                            </div>
                        </div>
                        <button onclick="saveClassSettingsUI(this)" style="background:var(--color-teacher);">💾 반 구성
                            저장하기</button>
                        <p style="font-size:0.8rem; color:var(--text-sub); margin-top:10px; text-align:center;">※
                            학생 수와 모둠 수를 설정합니다.</p>
                    </div>
                    <div class="accent-box box-blue class-tone-section">
                        <span class="box-label">👥 학생 번호 매핑 현황</span>
                        <p style="font-size:0.82rem; color:var(--text-sub); margin-bottom:12px;">
                            각 번호에 등록된 Google 계정을 확인하고, 필요시 등록을 해제할 수 있습니다.
                        </p>
                        <div id="studentMappingGrid" class="student-manage-grid"></div>
                    </div>
                    <div class="accent-box box-red">
                        <span class="box-label" style="color:var(--color-danger);">⚠️ 데이터 초기화</span>
                        <p style="color:var(--color-danger); font-size:0.9rem; margin-bottom:15px;">
                            <strong>주의:</strong>
                            모든 학급 내 데이터가 삭제됩니다.
                        </p>
                        <button id="resetBtn" onclick="resetAllReviewData(this)">학급 데이터 전체 초기화</button>
                    </div>
                    <div id="settingMsg" class="message"></div>
                </div>
            </div>
        </div>
    </div>
    <div id="customModal" class="modal-overlay hidden">
        <div class="modal-box">
            <span id="modalIcon" class="modal-icon">🤔</span>
            <div id="modalTitle" class="modal-title">알림</div>
            <div id="modalMessage" class="modal-text"></div>
            <input type="text" id="modalInput" class="hidden"
                style="width:100%; box-sizing:border-box; padding:12px; margin-bottom:20px; border:2px solid var(--border); border-radius:10px; font-size:1rem; outline:none;">
            <div class="modal-buttons">
                <button class="modal-btn cancel" id="modalCancelBtn">취소</button>
                <button class="modal-btn confirm" id="modalConfirmBtn">확인</button>
            </div>
        </div>
    </div>
    <!-- 교과세특 엑셀 다운로드 모달 -->
    <div id="teacherSubjectCommentExportModal" class="modal-overlay hidden">
        <div class="modal-box teacher-subject-comment-export-box">
            <span class="modal-icon">📊</span>
            <div class="modal-title">교과세특(.xlsx) 다운로드</div>
            <div class="modal-text teacher-subject-comment-export-text">
                <div class="teacher-subject-comment-export-grid">
                    <div>
                        <label class="teacher-subject-comment-export-label">학기</label>
                        <select id="teacherSubjectCommentExportSemester" class="class-tone-input teacher-subject-comment-export-input">
                            <option value="all" selected>전체</option>
                            <option value="1">1학기</option>
                            <option value="2">2학기</option>
                        </select>
                    </div>
                    <div>
                        <label class="teacher-subject-comment-export-label">과목</label>
                        <select id="teacherSubjectCommentExportSubject" class="class-tone-input teacher-subject-comment-export-input">
                            <option value="all" selected>전체</option>
                        </select>
                    </div>
                    <div>
                        <label class="teacher-subject-comment-export-label">대상</label>
                        <select id="teacherSubjectCommentExportTarget" class="class-tone-input teacher-subject-comment-export-input">
                            <option value="all" selected>전체 학생</option>
                            <option value="selected">선택 학생</option>
                            <option value="current">현재 학생</option>
                        </select>
                    </div>
                    <div>
                        <label class="teacher-subject-comment-export-label">학교급</label>
                        <select id="teacherSubjectCommentExportSchoolLevel" class="class-tone-input teacher-subject-comment-export-input">
                            <option value="">(설정 사용)</option>
                            <option value="초">초</option>
                            <option value="중">중</option>
                            <option value="고">고</option>
                        </select>
                    </div>
                </div>

                <div id="teacherSubjectCommentExportSelectedArea" class="hidden teacher-subject-comment-export-selected">
                    <div class="teacher-subject-comment-export-selected-title">선택 학생(번호)</div>
                    <div id="teacherSubjectCommentExportStudentGrid" class="teacher-subject-comment-export-student-grid"></div>
                </div>

                <div id="teacherSubjectCommentExportMsg" class="message teacher-subject-comment-export-msg"></div>
            </div>
            <div class="modal-buttons">
                <button class="modal-btn cancel" type="button" onclick="closeTeacherSubjectCommentExportModal()">취소</button>
                <button class="modal-btn confirm" type="button" onclick="downloadTeacherSubjectCommentXlsx()">다운로드</button>
            </div>
        </div>
    </div>

    <!-- SheetJS (xlsx) -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script src="app.js?v=20260216-personality-type-fix-1"></script>
</body>

</html>


